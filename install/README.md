# Installation

*install.sh* script has to be launch has root. It will procede to the installation of the backend and its dependencies. Password will be asked but can be generated by *makepasswd* (16 chars long by default) and will be consultable in **.env** file. 1 SystemD service will be created :
 - *arbalet.service* (backend)
and *systemd-resolved.service* will be disabled.

# Matomo initialisation

When the backend is started for the first time (or completely recreated), matomo service is still to configure. Open a web browser to [matomo.arbalet-project.org](matomo.arbalet-project.org). Follow the initialisation procedure (the prefilled information concerning mariadb are correct) and choose an admin login and password. Once it is done, add the site you want to follow in the next order :
 - live.arbalet-project.org
 - frontage.arbalet-project.org
 - application

 Ntd : if they are not set in the right order, you will recieved information comming from those site but they won't match their name in matomo entries. The first entry is live service, the second is the landing page and the last one is the app.

Then in Administration > System > General settings, enable CORS for:
http://localhost:33400
http://localhost:33450
http://localhost:33460
http://localhost:8100
http://frontage.arbalet-project.org
http://live.arbalet-project.org
http://matomo.arbalet-project.org


# Manage services
```
sudo service arbalet stop
sudo service arbalet start
sudo systemctl status arbalet.service
sudo journalctl -u arbalet -f

```

```
cd prod
docker-compose run --rm app set_admin_credentials  # Change your admin password
docker-compose run --rm app reset  # Factory reset (Dropping DB)
```

# Troubleshooting
```
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) FATAL:  password authentication failed for user "some_suer"
```
First make sure `.env` has non-empty random passwords. In case the prod server is being reinstalled, make sure you destroy all the volumes `docker-compose down -v`. Also do not forget `-f` to specify the prod config.

# Internet

To access the Internet, arbalet service has to be stopped and systemd-resolved start. If its not enough, unplug the ethernet cable connected to the wifi access point and run dhclient to aquiere a valid IP.
